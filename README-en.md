# Nginx Supporting Chinese SM Algorithms

Nginx supporting CNTLS SM Algorithms via TASSL.

When tring to build a platform that compliant with SM standards, I found it difficult to find a suitable open-source system. 
Finally, I found the open-source library provided by Jiangnan Tianan (https://www.tass.com.cn/), which also includes a modified version of Nginx.

However, their modifications were based on Nginx version 1.16. I referenced their modifications and worked up to Nginx 1.28.0

Switch to the stable-1.28-sm branch, download the code, and then compile it according to the steps below to obtain Nginx 1.28 that supports SM algorithms.

Note: The latest version of TASSL is https://github.com/jntass/TASSL-1.1.1 (this version can be used with native Nginx to build a Chinese SM SSL web server and reverse proxy; for implementing a Chinese SM cryptographic SSL forward proxy, please use the customized Nginx in this repository).

## How to make Nginx call TASSL to implement the SM SSL protocol? The specific steps are as follows:

1. Download, compile, and install TASSL-1.1.1 from https://github.com/jntass/TASSL-1.1.1.

2. Download the code from the stable-1.28-sm branch and compile it.

./configure --with-http_ssl_module --with-stream --with-stream_ssl_module --with-openssl=/usr/local/tassl --prefix=/usr/local/nginx

Note: --with-openssl is followed by the TASSL source code path.

make
make install

3. Configure nginx.

Configure the certificate section of nginx.conf:

`ssl_certificate /usr/local/tassl/tassl_demo/cert/certs/SS.crt; #/*Signing certificate*/`
`ssl_certificate_key /usr/local/tassl/tassl_demo/cert/certs/SS.key; #/*Signing private key*/`
`ssl_enc_certificate /usr/local/tassl/tassl_demo/cert/certs/SE.crt; #/*Encryption certificate*/`
`ssl_enc_certificate_key /usr/local/tassl/tassl_demo/cert/certs/SE.key; #/*Encryption private key*/`

Note: The signing certificate must have data signing functionality, and the encryption certificate must have data encryption functionality. Incorrect functionality will cause the handshake to fail. The certificate generated by calling the script in `tassl_demo/cert/` already has the corresponding functionality and can be used for testing.

# Download a Chinese cryptographic browser for testing.

Although there are many browsers that support commercial cryptography, such as the 360 GM Browser, but finally you need to buy licenses.

I recommend using the free ZoTrus Browser to verify SM functions: https://www.zotrus.com/browser/ Besides providing a free browser, ZoTrus is also a certificate authority. You can apply for a free internal test certificate through its URL: https://cersign.com/intranet-ssl-certificates.html; official certificates can be purchased at https://www.zotrus.com/identity/index.html